<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Amuri Audit Engine v3.4 - Status Tracking</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Identity Services -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <style>
        @media print {
            .no-print { display: none !important; }
            body { background: white; padding: 0; }
            .page { margin: 0; box-shadow: none; width: 100%; padding: 10mm 15mm; }
            .finding-card { border: 1px solid #eee; break-inside: avoid; }
        }
        .page {
            background: white;
            width: 210mm;
            min-height: 297mm;
            padding: 20mm;
            margin: 10mm auto;
            box-shadow: 0 0 15px rgba(0,0,0,0.1);
            font-family: 'Segoe UI', system-ui, sans-serif;
            color: #1a1a1a;
            position: relative;
        }
        input, textarea { border: none; border-bottom: 1px dotted #999; width: 100%; padding: 4px; font-family: inherit; }
        input:focus, textarea:focus { outline: none; background-color: #f8fafc; border-bottom: 2px solid #2563eb; }
        .section-title { border-left: 4px solid #2563eb; padding-left: 10px; font-weight: bold; text-transform: uppercase; font-size: 0.85rem; margin-bottom: 1.5rem; color: #1e40af; }
        .finding-card { border: 1px solid #e2e8f0; border-radius: 12px; padding: 1.5rem; margin-bottom: 2.5rem; background-color: #ffffff; position: relative; z-index: 10; }
        
        /* Badges de Risco */
        .risk-badge input:checked + span.crítico { background-color: #ef4444; color: white; border-color: #ef4444; }
        .risk-badge input:checked + span.alto { background-color: #f97316; color: white; border-color: #f97316; }
        .risk-badge input:checked + span.médio { background-color: #eab308; color: white; border-color: #eab308; }
        .risk-badge input:checked + span.baixo { background-color: #22c55e; color: white; border-color: #22c55e; }
        
        /* Badges de Impacto */
        .impact-badge input:checked + span { background-color: #3b82f6; color: white; border-color: #3b82f6; }

        /* Badges de Status */
        .status-badge input:checked + span.pendente { background-color: #64748b; color: white; border-color: #64748b; }
        .status-badge input:checked + span.andamento { background-color: #3b82f6; color: white; border-color: #3b82f6; }
        .status-badge input:checked + span.concluido { background-color: #10b981; color: white; border-color: #10b981; }
        .status-badge input:checked + span.bloqueado { background-color: #dc2626; color: white; border-color: #dc2626; }

        .image-preview { max-width: 100%; max-height: 250px; object-fit: contain; border-radius: 4px; margin-top: 10px; border: 1px solid #e2e8f0; }
        
        .watermark { 
            position: absolute; 
            bottom: 30px; 
            right: 30px; 
            font-size: 8px; 
            font-weight: 900; 
            color: #f1f5f9; 
            text-transform: uppercase; 
            letter-spacing: 5px; 
            pointer-events: none; 
            user-select: none; 
            z-index: 1; 
        }
        
        #loading-modal { display: none; }
    </style>
</head>
<body class="bg-slate-50 p-4 pb-20">

    <!-- Barra de Ferramentas Superior -->
    <div class="no-print bg-slate-900 text-white p-4 mb-8 rounded-2xl max-w-5xl mx-auto flex justify-between items-center shadow-2xl sticky top-4 z-[100]">
        <div class="flex items-center gap-4">
            <div class="bg-blue-600 p-2 rounded-lg">
                <svg xmlns="http://www.w3.org/2003/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10"/></svg>
            </div>
            <div class="hidden sm:block">
                <h1 class="font-bold text-lg leading-tight">Amuri Audit <span class="text-blue-400 text-sm">v3.4</span></h1>
                <p class="text-[10px] uppercase tracking-widest opacity-60 italic">Status Tracking Enabled</p>
            </div>
        </div>
        <div class="flex gap-2">
            <button onclick="addFinding()" class="bg-slate-800 border border-slate-700 hover:bg-slate-700 text-white px-3 py-2 rounded-xl text-xs font-bold transition-all flex items-center gap-2">
                + Novo Achado
            </button>
            <button onclick="handleDriveSave()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-xl text-xs font-bold transition-all shadow-lg flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2003/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
                Salvar no Drive
            </button>
            <button onclick="window.print()" class="bg-white text-slate-900 px-4 py-2 rounded-xl text-xs font-bold transition-all hover:bg-slate-100 flex items-center gap-2">
                PDF
            </button>
        </div>
    </div>

    <!-- Modal de Status -->
    <div id="loading-modal" class="fixed inset-0 bg-black/50 z-[200] flex items-center justify-center p-4">
        <div class="bg-white p-8 rounded-2xl max-w-sm w-full text-center shadow-2xl">
            <div id="loader-icon" class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"></div>
            <h3 id="status-title" class="font-bold text-lg mb-2 text-slate-800">Sincronizando...</h3>
            <p id="status-desc" class="text-sm text-slate-500 mb-6">Estamos convertendo seu relatório.</p>
            <button id="close-modal-btn" onclick="toggleModal(false)" class="hidden bg-slate-900 text-white px-6 py-2 rounded-xl font-bold text-sm w-full">Entendido</button>
        </div>
    </div>

    <div id="report-content">
        <div class="page" id="main-page">
            <!-- Cabeçalho -->
            <div class="flex justify-between items-start mb-12">
                <div>
                    <h2 class="text-3xl font-black uppercase tracking-tighter text-slate-800">Relatório de Auditoria</h2>
                    <p class="text-blue-600 font-bold text-sm tracking-widest uppercase mt-1">Inspeção Técnica e Segurança</p>
                </div>
                <div class="text-right">
                    <div class="text-[10px] font-bold text-slate-400 uppercase">Documento ID</div>
                    <input type="text" id="doc-id" value="AMR-2026-AUD-001" class="text-sm font-mono font-bold text-slate-600 text-right bg-transparent border-none p-0 focus:bg-transparent">
                </div>
            </div>

            <!-- Dados da Empresa -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-12">
                <div class="space-y-4">
                    <div><label class="text-[10px] font-black text-slate-400 uppercase block">Empresa Cliente</label><input type="text" id="client-name" placeholder="Ex: Cogitari Ltda"></div>
                    <div><label class="text-[10px] font-black text-slate-400 uppercase block">Ambiente</label><input type="text" placeholder="Ex: Produção / AWS"></div>
                </div>
                <div class="space-y-4">
                    <div class="grid grid-cols-2 gap-4">
                        <div><label class="text-[10px] font-black text-slate-400 uppercase block">Início</label><input type="text" placeholder="DD/MM/AA"></div>
                        <div><label class="text-[10px] font-black text-slate-400 uppercase block">Fim</label><input type="text" placeholder="DD/MM/AA"></div>
                    </div>
                    <div><label class="text-[10px] font-black text-slate-400 uppercase block">Auditor Responsável</label><input type="text" placeholder="Nome"></div>
                </div>
            </div>

            <h3 class="section-title">1. Sumário Executivo</h3>
            <textarea rows="4" class="text-sm w-full p-4 bg-slate-50 rounded-xl mb-12 border border-slate-100" placeholder="Resumo dos achados principais..."></textarea>

            <h3 class="section-title">2. Registro de Ocorrências Técnicas</h3>
            <div id="findings-container">
                <!-- Achado #01 padrão com todos os campos -->
                <div class="finding-card border-l-8 border-l-slate-800" id="finding-1">
                    <div class="flex justify-between items-center mb-6">
                        <span class="bg-slate-800 text-white px-4 py-1.5 rounded-full text-[10px] font-bold uppercase tracking-widest">Achado #01</span>
                    </div>
                    <div class="space-y-6">
                        <div>
                            <label class="text-[10px] font-black text-slate-500 uppercase block mb-2">Descrição da Ocorrência:</label>
                            <textarea rows="3" class="text-sm p-3 border rounded-lg bg-slate-50 w-full" placeholder="Detalhes do problema..."></textarea>
                        </div>
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                            <div>
                                <label class="text-[10px] font-black text-slate-500 uppercase block mb-3">Nível de Risco:</label>
                                <div class="flex gap-2">
                                    <label class="risk-badge flex-1"><input type="radio" name="risk-1" class="hidden"><span class="crítico block text-center py-2 border rounded-lg text-[10px] font-bold uppercase cursor-pointer transition">Crítico</span></label>
                                    <label class="risk-badge flex-1"><input type="radio" name="risk-1" class="hidden"><span class="alto block text-center py-2 border rounded-lg text-[10px] font-bold uppercase cursor-pointer transition">Alto</span></label>
                                    <label class="risk-badge flex-1"><input type="radio" name="risk-1" class="hidden"><span class="médio block text-center py-2 border rounded-lg text-[10px] font-bold uppercase cursor-pointer transition">Médio</span></label>
                                    <label class="risk-badge flex-1"><input type="radio" name="risk-1" class="hidden"><span class="baixo block text-center py-2 border rounded-lg text-[10px] font-bold uppercase cursor-pointer transition">Baixo</span></label>
                                </div>
                            </div>
                            <div>
                                <label class="text-[10px] font-black text-slate-500 uppercase block mb-3">Impactos:</label>
                                <div class="grid grid-cols-2 gap-2">
                                    <label class="impact-badge"><input type="checkbox" class="hidden"><span class="block text-center py-2 border rounded-lg text-[10px] font-bold uppercase cursor-pointer transition">Segurança</span></label>
                                    <label class="impact-badge"><input type="checkbox" class="hidden"><span class="block text-center py-2 border rounded-lg text-[10px] font-bold uppercase cursor-pointer transition">Operacional</span></label>
                                    <label class="impact-badge"><input type="checkbox" class="hidden"><span class="block text-center py-2 border rounded-lg text-[10px] font-bold uppercase cursor-pointer transition">Jurídico</span></label>
                                    <label class="impact-badge"><input type="checkbox" class="hidden"><span class="block text-center py-2 border rounded-lg text-[10px] font-bold uppercase cursor-pointer transition">Privacidade</span></label>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Nova Seção: Status da Ação -->
                        <div>
                            <label class="text-[10px] font-black text-slate-500 uppercase block mb-3">Status da Ação:</label>
                            <div class="grid grid-cols-4 gap-2">
                                <label class="status-badge"><input type="radio" name="status-1" class="hidden"><span class="pendente block text-center py-2 border rounded-lg text-[10px] font-bold uppercase cursor-pointer transition">Pendente</span></label>
                                <label class="status-badge"><input type="radio" name="status-1" class="hidden"><span class="andamento block text-center py-2 border rounded-lg text-[10px] font-bold uppercase cursor-pointer transition">Em Andamento</span></label>
                                <label class="status-badge"><input type="radio" name="status-1" class="hidden"><span class="concluido block text-center py-2 border rounded-lg text-[10px] font-bold uppercase cursor-pointer transition">Concluído</span></label>
                                <label class="status-badge"><input type="radio" name="status-1" class="hidden"><span class="bloqueado block text-center py-2 border rounded-lg text-[10px] font-bold uppercase cursor-pointer transition">Bloqueado</span></label>
                            </div>
                        </div>

                        <!-- Evidências -->
                        <div class="pt-4 border-t border-slate-100">
                            <label class="text-[10px] font-black text-blue-600 uppercase block mb-4 tracking-widest">Evidências e Referências</label>
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                <div class="bg-slate-50 p-4 rounded-xl border border-dashed border-slate-300">
                                    <p class="text-[10px] font-bold text-slate-400 mb-3 uppercase">Print/Imagem:</p>
                                    <input type="file" accept="image/*" onchange="previewImage(this)" class="no-print text-[10px] mb-2 cursor-pointer">
                                    <div class="image-container hidden">
                                        <img src="" class="image-preview" alt="Evidência">
                                        <button onclick="removeImage(this)" class="no-print text-red-500 text-[10px] mt-2 font-bold uppercase">Remover</button>
                                    </div>
                                </div>
                                <div class="bg-slate-50 p-4 rounded-xl border border-slate-200">
                                    <p class="text-[10px] font-bold text-slate-400 mb-3 uppercase">Links:</p>
                                    <div class="links-list space-y-2 mb-3"></div>
                                    <button onclick="addLinkRow(this)" class="no-print text-blue-600 text-[10px] font-bold uppercase hover:underline">+ Link</button>
                                </div>
                            </div>
                        </div>

                        <div>
                            <label class="text-[10px] font-black text-slate-500 uppercase block mb-2">Recomendação Técnica:</label>
                            <textarea rows="2" class="text-sm p-3 border rounded-lg bg-blue-50/30 w-full" placeholder="Ação corretiva..."></textarea>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Botão Secundário de Adicionar (Restaurado) -->
            <div class="no-print flex justify-center py-6">
                <button onclick="addFinding()" class="group flex items-center gap-3 bg-slate-100 hover:bg-blue-600 hover:text-white px-8 py-4 rounded-2xl transition-all duration-300 border-2 border-dashed border-slate-300 hover:border-blue-600">
                    <span class="bg-blue-600 text-white p-1 rounded-full group-hover:bg-white group-hover:text-blue-600">
                        <svg xmlns="http://www.w3.org/2003/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                    </span>
                    <span class="font-bold uppercase text-xs tracking-widest">Adicionar Outra Ocorrência</span>
                </button>
            </div>

            <div class="watermark">Cogitari Compliance Engine</div>
        </div>

        <!-- Parecer Final -->
        <div class="page">
            <h3 class="section-title">3. Parecer Final</h3>
            <textarea rows="15" class="text-sm w-full p-6 bg-slate-50 rounded-2xl mb-12" placeholder="Conclusão da auditoria..."></textarea>

            <div class="grid grid-cols-2 gap-x-12 gap-y-20 mt-24">
                <div class="border-t-2 border-slate-900 pt-3">
                    <p class="text-[10px] font-black uppercase">Auditor 1</p>
                    <p class="text-[9px] text-slate-400">____ / ____ / ____</p>
                </div>
                <div class="border-t-2 border-slate-900 pt-3">
                    <p class="text-[10px] font-black uppercase">Auditor 2</p>
                    <p class="text-[9px] text-slate-400">____ / ____ / ____</p>
                </div>
            </div>
            <div class="watermark">Cogitari Compliance Engine</div>
        </div>
    </div>

    <script>
        const CLIENT_ID = ''; // Maurício, cole seu Client ID aqui
        const SCOPES = 'https://www.googleapis.com/auth/drive.file';

        let tokenClient;
        let accessToken = null;

        function initGoogleDrive() {
            if (!CLIENT_ID) {
                console.warn("CLIENT_ID não configurado. Sincronização com Drive desativada.");
                return;
            }

            try {
                if (typeof google !== 'undefined' && google.accounts && google.accounts.oauth2) {
                    tokenClient = google.accounts.oauth2.initTokenClient({
                        client_id: CLIENT_ID,
                        scope: SCOPES,
                        callback: (tokenResponse) => {
                            accessToken = tokenResponse.access_token;
                            if (accessToken) uploadToDrive();
                        },
                    });
                } else {
                    setTimeout(initGoogleDrive, 500);
                }
            } catch (e) {
                console.error("Erro ao inicializar Google API:", e);
            }
        }

        window.addEventListener('load', initGoogleDrive);

        function toggleModal(show, title = '', desc = '', isError = false) {
            const modal = document.getElementById('loading-modal');
            const icon = document.getElementById('loader-icon');
            const btn = document.getElementById('close-modal-btn');
            
            if (show) {
                modal.style.display = 'flex';
                document.getElementById('status-title').innerText = title;
                document.getElementById('status-desc').innerText = desc;
                icon.className = isError ? "text-red-500 text-4xl mb-4" : "animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4";
                icon.innerHTML = isError ? "⚠️" : "";
                btn.classList.toggle('hidden', !isError);
            } else {
                modal.style.display = 'none';
            }
        }

        async function handleDriveSave() {
            if (!CLIENT_ID) {
                alert("Para salvar no Google Drive, você precisa editar o arquivo HTML e adicionar seu CLIENT_ID na linha 175.");
                return;
            }
            
            if (accessToken === null && tokenClient) {
                tokenClient.requestAccessToken({ prompt: 'consent' });
            } else if (accessToken) {
                uploadToDrive();
            } else {
                initGoogleDrive();
                alert("Tentando reconectar com o Google. Por favor, tente novamente em alguns segundos.");
            }
        }

        async function uploadToDrive() {
            toggleModal(true, "Enviando...", "Convertendo relatório para Google Doc...");

            const clientName = document.getElementById('client-name').value || "Empresa";
            const docId = document.getElementById('doc-id').value || "AUD";
            const fileName = `Auditoria - ${clientName} (${docId})`;

            const reportClone = document.getElementById('report-content').cloneNode(true);
            reportClone.querySelectorAll('.no-print').forEach(el => el.remove());
            
            const htmlContent = `<html><body style="font-family: Arial;">${reportClone.innerHTML}</body></html>`;

            const metadata = { name: fileName, mimeType: 'application/vnd.google-apps.document' };
            const form = new FormData();
            form.append('metadata', new Blob([JSON.stringify(metadata)], { type: 'application/json' }));
            form.append('file', new Blob([htmlContent], { type: 'text/html' }));

            try {
                const response = await fetch('https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart', {
                    method: 'POST',
                    headers: { 'Authorization': 'Bearer ' + accessToken },
                    body: form
                });

                if (response.ok) {
                    toggleModal(true, "Sucesso!", "O arquivo foi gerado no seu Drive.", false);
                    document.getElementById('close-modal-btn').classList.remove('hidden');
                    document.getElementById('loader-icon').innerHTML = "✅";
                    document.getElementById('loader-icon').classList.remove('animate-spin');
                } else {
                    throw new Error();
                }
            } catch (err) {
                toggleModal(true, "Erro", "Verifique sua conexão ou Client ID.", true);
            }
        }

        let findingCount = 1;
        function addFinding() {
            findingCount++;
            const container = document.getElementById('findings-container');
            const div = document.createElement('div');
            div.className = 'finding-card border-l-8 border-l-slate-800 animate-in fade-in slide-in-from-top-4 duration-300';
            div.innerHTML = `
                <div class="flex justify-between items-center mb-6">
                    <span class="bg-slate-800 text-white px-4 py-1.5 rounded-full text-[10px] font-bold uppercase tracking-widest">Achado #0${findingCount}</span>
                    <button onclick="this.closest('.finding-card').remove()" class="no-print text-red-500 hover:text-red-700 text-[10px] font-bold uppercase">Excluir</button>
                </div>
                <div class="space-y-6">
                    <div>
                        <label class="text-[10px] font-black text-slate-500 uppercase block mb-2">Descrição da Ocorrência:</label>
                        <textarea rows="3" class="text-sm p-3 border rounded-lg bg-slate-50 w-full" placeholder="Detalhes do problema..."></textarea>
                    </div>
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        <div>
                            <label class="text-[10px] font-black text-slate-500 uppercase block mb-3">Nível de Risco:</label>
                            <div class="flex gap-2">
                                <label class="risk-badge flex-1"><input type="radio" name="risk-${findingCount}" class="hidden"><span class="crítico block text-center py-2 border rounded-lg text-[10px] font-bold uppercase cursor-pointer transition">Crítico</span></label>
                                <label class="risk-badge flex-1"><input type="radio" name="risk-${findingCount}" class="hidden"><span class="alto block text-center py-2 border rounded-lg text-[10px] font-bold uppercase cursor-pointer transition">Alto</span></label>
                                <label class="risk-badge flex-1"><input type="radio" name="risk-${findingCount}" class="hidden"><span class="médio block text-center py-2 border rounded-lg text-[10px] font-bold uppercase cursor-pointer transition">Médio</span></label>
                                <label class="risk-badge flex-1"><input type="radio" name="risk-${findingCount}" class="hidden"><span class="baixo block text-center py-2 border rounded-lg text-[10px] font-bold uppercase cursor-pointer transition">Baixo</span></label>
                            </div>
                        </div>
                        <div>
                            <label class="text-[10px] font-black text-slate-500 uppercase block mb-3">Impactos:</label>
                            <div class="grid grid-cols-2 gap-2">
                                <label class="impact-badge"><input type="checkbox" class="hidden"><span class="block text-center py-2 border rounded-lg text-[10px] font-bold uppercase cursor-pointer transition">Segurança</span></label>
                                <label class="impact-badge"><input type="checkbox" class="hidden"><span class="block text-center py-2 border rounded-lg text-[10px] font-bold uppercase cursor-pointer transition">Operacional</span></label>
                                <label class="impact-badge"><input type="checkbox" class="hidden"><span class="block text-center py-2 border rounded-lg text-[10px] font-bold uppercase cursor-pointer transition">Jurídico</span></label>
                                <label class="impact-badge"><input type="checkbox" class="hidden"><span class="block text-center py-2 border rounded-lg text-[10px] font-bold uppercase cursor-pointer transition">Privacidade</span></label>
                            </div>
                        </div>
                    </div>

                    <!-- Status da Ação -->
                    <div>
                        <label class="text-[10px] font-black text-slate-500 uppercase block mb-3">Status da Ação:</label>
                        <div class="grid grid-cols-4 gap-2">
                            <label class="status-badge"><input type="radio" name="status-${findingCount}" class="hidden"><span class="pendente block text-center py-2 border rounded-lg text-[10px] font-bold uppercase cursor-pointer transition">Pendente</span></label>
                            <label class="status-badge"><input type="radio" name="status-${findingCount}" class="hidden"><span class="andamento block text-center py-2 border rounded-lg text-[10px] font-bold uppercase cursor-pointer transition">Em Andamento</span></label>
                            <label class="status-badge"><input type="radio" name="status-${findingCount}" class="hidden"><span class="concluido block text-center py-2 border rounded-lg text-[10px] font-bold uppercase cursor-pointer transition">Concluído</span></label>
                            <label class="status-badge"><input type="radio" name="status-${findingCount}" class="hidden"><span class="bloqueado block text-center py-2 border rounded-lg text-[10px] font-bold uppercase cursor-pointer transition">Bloqueado</span></label>
                        </div>
                    </div>

                    <div class="pt-4 border-t border-slate-100">
                        <label class="text-[10px] font-black text-blue-600 uppercase block mb-4 tracking-widest">Evidências e Referências</label>
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <div class="bg-slate-50 p-4 rounded-xl border border-dashed border-slate-300">
                                <p class="text-[10px] font-bold text-slate-400 mb-3 uppercase">Print/Imagem:</p>
                                <input type="file" accept="image/*" onchange="previewImage(this)" class="no-print text-[10px] mb-2 cursor-pointer">
                                <div class="image-container hidden">
                                    <img src="" class="image-preview" alt="Evidência">
                                    <button onclick="removeImage(this)" class="no-print text-red-500 text-[10px] mt-2 font-bold uppercase">Remover</button>
                                </div>
                            </div>
                            <div class="bg-slate-50 p-4 rounded-xl border border-slate-200">
                                <p class="text-[10px] font-bold text-slate-400 mb-3 uppercase">Links:</p>
                                <div class="links-list space-y-2 mb-3"></div>
                                <button onclick="addLinkRow(this)" class="no-print text-blue-600 text-[10px] font-bold uppercase hover:underline">+ Link</button>
                            </div>
                        </div>
                    </div>
                    <div>
                        <label class="text-[10px] font-black text-slate-500 uppercase block mb-2">Recomendação:</label>
                        <textarea rows="2" class="text-sm p-3 border rounded-lg bg-blue-50/30 w-full" placeholder="Ação corretiva..."></textarea>
                    </div>
                </div>
            `;
            container.appendChild(div);
            div.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        function previewImage(input) {
            const container = input.parentElement.querySelector('.image-container');
            const preview = container.querySelector('img');
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = (e) => { preview.src = e.target.result; container.classList.remove('hidden'); input.classList.add('hidden'); }
                reader.readAsDataURL(input.files[0]);
            }
        }

        function removeImage(btn) {
            const container = btn.parentElement;
            const input = container.parentElement.querySelector('input[type="file"]');
            container.classList.add('hidden');
            input.classList.remove('hidden');
            input.value = '';
        }

        function addLinkRow(btn) {
            const list = btn.parentElement.querySelector('.links-list');
            const row = document.createElement('div');
            row.className = 'flex gap-1 items-center';
            row.innerHTML = `<input type="text" class="text-[9px] flex-1 border px-1" placeholder="URL"><button onclick="this.parentElement.remove()" class="text-red-400">×</button>`;
            list.appendChild(row);
        }
    </script>
</body>
</html>