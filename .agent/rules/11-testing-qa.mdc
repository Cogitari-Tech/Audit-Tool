---
description: Padr√µes de testes automatizados (E2E, Unit, Integration)
globs: tests/**/*, e2e/**/*
---
# üß™ TESTES E QA

## Contexto/Princ√≠pios
Garantir a estabilidade do SaaS com uma pir√¢mide de testes equilibrada.
- **E2E (Playwright)**: Fluxos cr√≠ticos do usu√°rio (Signup, Post Creation, Billing).
- **Unit (Vitest)**: Regras de neg√≥cio, utilit√°rios, hooks isolados.
- **BDD**: Testes descritivos (Describe -> It -> Expect).
- **Shadow Mode**: Testar integra√ß√µes em modo "dry-run" quando poss√≠vel.

## Implementa√ß√£o

### Teste E2E (Playwright)
```typescript
// ‚úÖ CORRETO: Seletores resilientes e assertions claras
test('usu√°rio deve conseguir criar um post rascunho', async ({ page }) => {
  // Arrange
  await page.goto('/dashboard/create');
  
  // Act
  await page.getByTestId('input-title').fill('Meu Novo Post');
  await page.getByTestId('editor-content').fill('Conte√∫do incr√≠vel...');
  await page.getByTestId('btn-save-draft').click();
  
  // Assert
  await expect(page.getByText('Rascunho salvo com sucesso')).toBeVisible();
  await expect(page).toHaveURL(/\/dashboard\/content/);
});
```

### Teste Unit√°rio (Vitest)
```typescript
// ‚úÖ CORRETO: Testando regra de neg√≥cio isolada
import { calculatePostCost } from './billing';

describe('Billing Logic', () => {
  it('should charge 1 credit for text posts', () => {
    const cost = calculatePostCost({ type: 'text' });
    expect(cost).toBe(1);
  });

  it('should charge 10 credits for video generation', () => {
    const cost = calculatePostCost({ type: 'video_ai' });
    expect(cost).toBe(10);
  });
});
```

### Mocking Externos
```typescript
// ‚úÖ CORRETO: Mockar API externa para n√£o gastar cota/dinheiro
vi.mock('@/lib/integrations/youtube', () => ({
  uploadVideo: vi.fn().mockResolvedValue(Result.ok('video_id_123'))
}));
```

## Edge Cases / Alertas
- ‚ö†Ô∏è **data-testid**: Sempre adicione `data-testid="nome-elemento"` em elementos interativos importantes para desacoplar testes do CSS/estrutura.
- ‚ö†Ô∏è **Flakiness**: Evite `waitForTimeout(5000)`. Use `await expect(...).toBeVisible()` ou `waitForLoadState('networkidle')`.
- üö® **Clean State**: Testes E2E devem rodar em banco isolado ou limpar dados ap√≥s execu√ß√£o (teardown).
