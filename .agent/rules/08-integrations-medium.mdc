---
description: Regras para integra√ß√£o com Medium API
globs: src/lib/integrations/medium/**/*
---
# üìñ INTEGRA√á√ÉO MEDIUM

## Contexto/Princ√≠pios
A API do Medium √© minimalista e focada em publica√ß√£o "fire-and-forget".
- **Draft Only**: A API n√£o permite editar posts ap√≥s publica√ß√£o. A estrat√©gia segura √© sempre publicar como `draft` e deixar o usu√°rio finalizar na plataforma.
- **Token**: Usa Integration Tokens de longa dura√ß√£o, obtidos nas configura√ß√µes do usu√°rio.
- **Rate Limit**: N√£o documentado oficialmente, mas agressivo contra spam.

## Implementa√ß√£o

### Cria√ß√£o de Post (Draft)
```typescript
// ‚úÖ CORRETO: Publica√ß√£o segura como rascunho
async function createMediumDraft(
  userId: string, 
  token: string, 
  content: BlogPost
): Promise<Result<string>> {
  // 1. Obter ID do usu√°rio Medium (necess√°rio para o endpoint de post)
  const userResp = await fetch('https://api.medium.com/v1/me', {
    headers: { Authorization: `Bearer ${token}` }
  });
  const userData = await userResp.json();
  const mediumId = userData.data.id;

  // 2. Criar Post
  const postResp = await fetch(`https://api.medium.com/v1/users/${mediumId}/posts`, {
    method: 'POST',
    headers: {
      Authorization: `Bearer ${token}`,
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      title: content.title,
      contentFormat: 'markdown', // Preferir Markdown a HTML
      content: content.markdownBody,
      publishStatus: 'draft',    // ‚ö†Ô∏è CR√çTICO: Sempre draft
      tags: content.tags.slice(0, 5) // Limite de 5 tags
    })
  });

  if (!postResp.ok) {
    return Result.fail(`Erro Medium: ${postResp.statusText}`);
  }

  const postData = await postResp.json();
  return Result.ok(postData.data.url);
}
```

### ‚ùå ERRADO: Anti-padr√µes
```typescript
// ‚ùå Tentar editar post (API n√£o suporta PUT/PATCH)
// ‚ùå Enviar mais de 5 tags (API ignora ou retorna erro)
// ‚ùå Publicar direto como 'public' sem revis√£o humana (risco de formata√ß√£o quebrada)
```

## Edge Cases / Alertas
- ‚ö†Ô∏è **Imagens**: A API do Medium automaticamente faz download de imagens linkadas no Markdown, mas isso pode falhar. Idealmente, use URLs p√∫blicas est√°veis.
- ‚ö†Ô∏è **Canonical URL**: Se for repost (cross-posting), sempre defina `canonicalUrl` para evitar penalidade de SEO (conte√∫do duplicado).
- üö® **Cota**: Erros 403 podem indicar token inv√°lido ou conta suspensa por spam.
