---
description: "Server Components, Client Components, Tailwind, shadcn/ui"
globs:
  - "src/app/**/*.tsx"
  - "src/components/**/*.tsx"
  - "src/app/*/page.tsx"
  - "src/app/*/layout.tsx"
---

# ⚛️ REGRAS DE FRONTEND - NEXT.JS & REACT

## Server vs Client Components (CRÍTICO)

### Princípio
**DEFAULT: Server Component** - Use Client Component APENAS quando necessário.

### Quando usar Client Component ('use client')
````typescript
// ✅ Necessário 'use client' quando:
'use client'; // OBRIGATÓRIO para:

import { useState } from 'react'; // 1. Hooks (useState, useEffect, etc)
import { useRouter } from 'next/navigation'; // 2. useRouter, useSearchParams

export function InteractiveButton() {
  const [count, setCount] = useState(0); // 3. Event handlers
  
  return (
    <button onClick={() => setCount(count + 1)}>
      Clicked {count} times
    </button>
  );
}

// ❌ NÃO use 'use client' para:
// - Componentes estáticos
// - Fetching de dados (use Server Components)
// - Layouts
````

### Boundary Pattern (Server ↔ Client)
````typescript
// ✅ CORRETO: Server Component faz fetch, Client Component renderiza
// app/dashboard/page.tsx (Server Component)
import { getUserCredits } from '@/lib/actions/user';
import { CreditsDisplay } from './credits-display'; // Client Component

export default async function DashboardPage() {
  const credits = await getUserCredits(); // Fetch no servidor
  
  return (
    <div>
      <h1>Dashboard</h1>
      <CreditsDisplay initialCredits={credits} /> {/* Passa para cliente */}
    </div>
  );
}

// components/credits-display.tsx (Client Component)
'use client';

export function CreditsDisplay({ initialCredits }: { initialCredits: number }) {
  const [credits, setCredits] = useState(initialCredits);
  
  // Lógica interativa aqui
  return <div>Credits: {credits}</div>;
}
````

## shadcn/ui (PADRÃO DE UI)
````typescript
// ✅ SEMPRE use componentes do shadcn/ui
import { Button } from '@/components/ui/button';
import { Card, CardContent, CardHeader } from '@/components/ui/card';

// ❌ NUNCA crie componentes básicos do zero se shadcn tem
<button className="px-4 py-2 bg-blue-500..."> {/* EVITAR */}

// ✅ Use shadcn e customize via className se necessário
<Button variant="outline" size="lg">
  Custom Button
</Button>
````

### Instalação de Componentes
````bash
# Adicionar componente
npx shadcn@latest add button
npx shadcn@latest add card
npx shadcn@latest add form
````

## Tailwind CSS (APENAS CORE UTILITIES)
````typescript
// ⚠️ IMPORTANTE: Sem compilador Tailwind customizado
// Use APENAS classes core do Tailwind

// ✅ PERMITIDO: Classes core
<div className="flex items-center gap-4 p-6 bg-gray-900 rounded-lg">

// ❌ PROIBIDO: Classes customizadas que requerem config
<div className="bg-amuri-primary text-brand-900"> {/* NÃO FUNCIONA */}

// ✅ Use CSS variables para cores customizadas
// globals.css
:root {
  --amuri-primary: #FF5733;
}

<div style={{ backgroundColor: 'var(--amuri-primary)' }}>
````

## Dark Mode (OBRIGATÓRIO)
````typescript
// ✅ Use next-themes
// app/layout.tsx
import { ThemeProvider } from '@/components/theme-provider';

export default function RootLayout({ children }) {
  return (
    <html lang="en" suppressHydrationWarning>
      <body>
        <ThemeProvider
          attribute="class"
          defaultTheme="system"
          enableSystem
          disableTransitionOnChange
        >
          {children}
        </ThemeProvider>
      </body>
    </html>
  );
}

// components/theme-toggle.tsx
'use client';

import { useTheme } from 'next-themes';
import { Button } from './ui/button';

export function ThemeToggle() {
  const { theme, setTheme } = useTheme();
  
  return (
    <Button
      variant="ghost"
      onClick={() => setTheme(theme === 'dark' ? 'light' : 'dark')}
    >
      Toggle Theme
    </Button>
  );
}

// CSS: Use Tailwind dark: modifier
<div className="bg-white dark:bg-gray-900 text-gray-900 dark:text-white">
````

## Forms (React Hook Form + Zod)
````typescript
// ✅ SEMPRE valide com Zod
import { useForm } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import * as z from 'zod';

const formSchema = z.object({
  email: z.string().email('Invalid email'),
  password: z.string().min(8, 'Password must be at least 8 characters'),
});

type FormValues = z.infer<typeof formSchema>;

export function LoginForm() {
  const form = useForm<FormValues>({
    resolver: zodResolver(formSchema),
    defaultValues: {
      email: '',
      password: '',
    },
  });

  async function onSubmit(data: FormValues) {
    // Submit logic
  }

  return (
    <form onSubmit={form.handleSubmit(onSubmit)}>
      {/* Form fields */}
    </form>
  );
}
````

## Image Optimization (next/image)
````typescript
// ✅ SEMPRE use next/image para imagens
import Image from 'next/image';

<Image
  src="/logo.png"
  alt="Amuri Logo"
  width={200}
  height={50}
  priority // Para LCP (Largest Contentful Paint)
  placeholder="blur" // Se tiver blurDataURL
/>

// ❌ NUNCA use <img> tag
<img src="/logo.png" alt="Logo" /> {/* PROIBIDO */}
````

## SEO (Metadata API)
````typescript
// app/page.tsx
import { Metadata } from 'next';

export const metadata: Metadata = {
  title: 'Amuri - AI Content Orchestration Platform',
  description: 'Generate and publish content across YouTube, TikTok, LinkedIn with AI',
  openGraph: {
    title: 'Amuri',
    description: 'AI-powered content generation',
    images: ['/og-image.png'],
  },
  twitter: {
    card: 'summary_large_image',
    title: 'Amuri',
    description: 'AI-powered content generation',
    images: ['/og-image.png'],
  },
};

export default function Page() {
  return <main>...</main>;
}

// Dynamic metadata
export async function generateMetadata({ params }): Promise<Metadata> {
  const post = await getPost(params.id);
  
  return {
    title: post.title,
    description: post.excerpt,
  };
}
````

## Loading States
````typescript
// ✅ Use Suspense + loading.tsx
// app/dashboard/loading.tsx
export default function Loading() {
  return <div>Loading dashboard...</div>;
}

// app/dashboard/page.tsx
export default async function DashboardPage() {
  const data = await fetchData(); // Suspende automaticamente
  return <div>{data}</div>;
}
````

## Error Handling
````typescript
// app/error.tsx (Error Boundary)
'use client';

export default function Error({
  error,
  reset,
}: {
  error: Error & { digest?: string };
  reset: () => void;
}) {
  return (
    <div>
      <h2>Something went wrong!</h2>
      <button onClick={() => reset()}>Try again</button>
    </div>
  );
}
````

## Internationalization (i18n)
````typescript
// ✅ Use next-intl
// app/[locale]/layout.tsx
import { NextIntlClientProvider } from 'next-intl';
import { notFound } from 'next/navigation';

export function generateStaticParams() {
  return [{ locale: 'en' }, { locale: 'pt' }, { locale: 'es' }];
}

export default async function LocaleLayout({ children, params: { locale } }) {
  let messages;
  try {
    messages = (await import(`@/messages/${locale}.json`)).default;
  } catch (error) {
    notFound();
  }

  return (
    <html lang={locale}>
      <body>
        <NextIntlClientProvider locale={locale} messages={messages}>
          {children}
        </NextIntlClientProvider>
      </body>
    </html>
  );
}

// messages/pt.json
{
  "home": {
    "title": "Bem-vindo ao Amuri",
    "cta": "Começar Agora"
  }
}

// Uso em componente
import { useTranslations } from 'next-intl';

export function Hero() {
  const t = useTranslations('home');
  return <h1>{t('title')}</h1>;
}
````

## Accessibility (WCAG 2.1)
````typescript
// ✅ SEMPRE:
// - Use semantic HTML
// - Adicione aria-labels
// - Garanta contraste de cores
// - Suporte navegação por teclado

<button
  aria-label="Close dialog"
  onClick={handleClose}
>
  <XIcon className="h-5 w-5" />
</button>

// ✅ Use role quando necessário
<div role="alert">Error message</div>

// ❌ NUNCA use divs para botões
<div onClick={handleClick}>Click me</div> {/* ERRADO */}
````

---

**LEMBRETE:** Server Components são o padrão. Use Client Components com parcimônia.